/*http v0.2*/
!function(a,b){'function'==typeof define?define(function(){return b(a)}):'object'==typeof exports?module.exports=b(require('http')):a.http=b(a)}(this,function(){function succeed(a){var b=protocolRe.exec(a.url);return b=b&&b[1]||context.location.protocol,httpsRe.test(b)?twoHundo.test(a.request.status):!!a.request.response}function handleReadyState(a,b,c){return function(){return a._aborted?c(a.request):a._timedOut?c(a.request,'Request is aborted: timeout'):(a.request&&4==a.request[readyState]&&(a.request.onreadystatechange=noop,succeed(a)?b(a.request):c(a.request)),void 0)}}function setHeaders(a,b){var c,d,e=b.headers||{};e.Accept=e.Accept||defaultHeaders.accept[b.type]||defaultHeaders.accept['*'],d='undefined'!=typeof FormData&&b.data instanceof FormData,b.crossOrigin||e[requestedWith]||(e[requestedWith]=defaultHeaders.requestedWith),e[contentType]||d||(e[contentType]=b.contentType||defaultHeaders.contentType);for(c in e)e.hasOwnProperty(c)&&'setRequestHeader'in a&&a.setRequestHeader(c,e[c])}function setCredentials(a,b){'undefined'!=typeof b.withCredentials&&'undefined'!=typeof a.withCredentials&&(a.withCredentials=!!b.withCredentials)}function generalCallback(a){lastValue=a}function urlappend(a,b){return a+(/\?/.test(a)?'&':'?')+b}function handleJsonp(a,b,c,d){var e=uniqid++,f=a.jsonpCallback||'callback',g=a.jsonpCallbackName||http.getcallbackPrefix(e),h=new RegExp('((^|\\?|&)'+f+')=([^&]+)'),i=d.match(h),j=doc.createElement('script'),k=0,l=-1!==navigator.userAgent.indexOf('MSIE 10.0');return i?'?'===i[3]?d=d.replace(h,'$1='+g):g=i[3]:d=urlappend(d,f+'='+g),context[g]=generalCallback,j.type='text/javascript',j.src=d,j.async=!0,'undefined'==typeof j.onreadystatechange||l||(j.htmlFor=j.id='_reqwest_'+e),j.onload=j.onreadystatechange=function(){return j[readyState]&&'complete'!==j[readyState]&&'loaded'!==j[readyState]||k?!1:(j.onload=j.onreadystatechange=null,j.onclick&&j.onclick(),b(lastValue),lastValue=void 0,head.removeChild(j),k=1,void 0)},head.appendChild(j),{abort:function(){j.onload=j.onreadystatechange=null,c({},'Request is aborted: timeout',{}),lastValue=void 0,head.removeChild(j),k=1}}}function getRequest(a,b){var c,d=this.o,e=(d.method||'GET').toUpperCase(),f='string'==typeof d?d:d.url,g=d.processData!==!1&&d.data&&'string'!=typeof d.data?http.toQueryString(d.data):d.data||null,h=!1;return'jsonp'!=d.type&&'GET'!=e||!g||(f=urlappend(f,g),g=null),'jsonp'==d.type?handleJsonp(d,a,b,f):(c=d.xhr&&d.xhr(d)||xhr(d),c.open(e,f,d.async===!1?!1:!0),setHeaders(c,d),setCredentials(c,d),context[xDomainRequest]&&c instanceof context[xDomainRequest]?(c.onload=a,c.onerror=b,c.onprogress=function(){},h=!0):c.onreadystatechange=handleReadyState(this,a,b),d.before&&d.before(c),h?setTimeout(function(){c.send(g)},200):c.send(g),c)}function Reqwest(a,b){this.o=a,this.fn=b,init.apply(this,arguments)}function setType(a){return null===a?void 0:a.match('json')?'json':a.match('javascript')?'js':a.match('text')?'html':a.match('xml')?'xml':void 0}function init(o,fn){function complete(a){for(o.timeout&&clearTimeout(self.timeout),self.timeout=null;self._completeHandlers.length>0;)self._completeHandlers.shift()(a)}function success(resp){var filteredResponse,r,type=o.type||resp&&setType(resp.getResponseHeader('Content-Type'));resp='jsonp'!==type?self.request:resp,filteredResponse=globalSetupOptions.dataFilter(resp.responseText,type),r=filteredResponse;try{resp.responseText=r}catch(e){}if(r)switch(type){case'json':try{resp=context.JSON?context.JSON.parse(r):eval('('+r+')')}catch(err){return error(resp,'Could not parse JSON in response',err)}break;case'js':resp=eval(r);break;case'html':resp=r;break;case'xml':resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML}for(self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp),self._successHandler(resp);self._fulfillmentHandlers.length>0;)resp=self._fulfillmentHandlers.shift()(resp);complete(resp)}function timedOut(){self._timedOut=!0,self.request.abort()}function error(a,b,c){for(a=self.request,self._responseArgs.resp=a,self._responseArgs.msg=b,self._responseArgs.t=c,self._erred=!0;self._errorHandlers.length>0;)self._errorHandlers.shift()(a,b,c);complete(a)}this.url='string'==typeof o?o:o.url,this.timeout=null,this._fulfilled=!1,this._successHandler=function(){},this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){timedOut()},o.timeout)),o.success&&(this._successHandler=function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest.call(this,success,error)}function http(a,b){return new Reqwest(a,b)}function normalize(a){return a?a.replace(/\r?\n/g,'\r\n'):''}function serial(a,b){var c,d,e,f,g=a.name,h=a.tagName.toLowerCase(),i=function(a){a&&!a.disabled&&b(g,normalize(a.attributes.value&&a.attributes.value.specified?a.value:a.text))};if(!a.disabled&&g)switch(h){case'input':/reset|button|image|file/i.test(a.type)||(c=/checkbox/i.test(a.type),d=/radio/i.test(a.type),e=a.value,(!(c||d)||a.checked)&&b(g,normalize(c&&''===e?'on':e)));break;case'textarea':b(g,normalize(a.value));break;case'select':if('select-one'===a.type.toLowerCase())i(a.selectedIndex>=0?a.options[a.selectedIndex]:null);else for(f=0;a.length&&f<a.length;f++)a.options[f].selected&&i(a.options[f])}}function eachFormElement(){var a,b,c=this,d=function(a,b){var d,e,f;for(d=0;d<b.length;d++)for(f=a[byTag](b[d]),e=0;e<f.length;e++)serial(f[e],c)};for(b=0;b<arguments.length;b++)a=arguments[b],/input|select|textarea/i.test(a.tagName)&&serial(a,c),d(a,['input','select','textarea'])}function serializeQueryString(){return http.toQueryString(http.serializeArray.apply(null,arguments))}function serializeHash(){var a={};return eachFormElement.apply(function(b,c){b in a?(a[b]&&!isArray(a[b])&&(a[b]=[a[b]]),a[b].push(c)):a[b]=c},arguments),a}function buildParams(a,b,c,d){var e,f,g,h=/\[\]$/;if(isArray(b))for(f=0;b&&f<b.length;f++)g=b[f],c||h.test(a)?d(a,g):buildParams(a+'['+('object'==typeof g?f:'')+']',g,c,d);else if(b&&'[object Object]'===b.toString())for(e in b)buildParams(a+'['+e+']',b[e],c,d);else d(a,b)}var doc,byTag,head,XHR2,httpsRe,protocolRe,twoHundo,readyState,contentType,requestedWith,uniqid,callbackPrefix,lastValue,xmlHttpRequest,xDomainRequest,noop,isArray,defaultHeaders,xhr,globalSetupOptions,context=this;if('window'in context)doc=document,byTag='getElementsByTagName',head=doc[byTag]('head')[0];else try{XHR2=require('xhr2')}catch(ex){throw new Error('xhr2 required!')}return httpsRe=/^http/,protocolRe=/(^\w+):\/\//,twoHundo=/^(20\d|1223)$/,readyState='readyState',contentType='Content-Type',requestedWith='X-Requested-With',uniqid=0,callbackPrefix='reqwest_'+ +new Date,xmlHttpRequest='XMLHttpRequest',xDomainRequest='XDomainRequest',noop=function(){},isArray='function'==typeof Array.isArray?Array.isArray:function(a){return a instanceof Array},defaultHeaders={contentType:'application/x-www-form-urlencoded',requestedWith:xmlHttpRequest,accept:{'*':'text/javascript, text/html, application/xml, text/xml, */*',xml:'application/xml, text/xml',html:'text/html',text:'text/plain',json:'application/json, text/javascript',js:'application/javascript, text/javascript'}},xhr=function(a){if(a.crossOrigin===!0){var b=context[xmlHttpRequest]?new XMLHttpRequest:null;if(b&&'withCredentials'in b)return b;if(context[xDomainRequest])return new XDomainRequest;throw new Error('Browser does not support cross-origin requests')}return context[xmlHttpRequest]?new XMLHttpRequest:XHR2?new XHR2:new ActiveXObject('Microsoft.XMLHTTP')},globalSetupOptions={dataFilter:function(a){return a}},Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(a,b){return a=a||function(){},b=b||function(){},this._fulfilled?this._responseArgs.resp=a(this._responseArgs.resp):this._erred?b(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(a),this._errorHandlers.push(b)),this},always:function(a){return this._fulfilled||this._erred?a(this._responseArgs.resp):this._completeHandlers.push(a),this},fail:function(a){return this._erred?a(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(a),this},'catch':function(a){return this.fail(a)}},http.serializeArray=function(){var a=[];return eachFormElement.apply(function(b,c){a.push({name:b,value:c})},arguments),a},http.serialize=function(){if(0===arguments.length)return'';var a,b,c=Array.prototype.slice.call(arguments,0);return a=c.pop(),a&&a.nodeType&&c.push(a)&&(a=null),a&&(a=a.type),b='map'==a?serializeHash:'array'==a?http.serializeArray:serializeQueryString,b.apply(null,c)},http.toQueryString=function(a,b){var c,d,e=b||!1,f=[],g=encodeURIComponent,h=function(a,b){b='function'==typeof b?b():null==b?'':b,f[f.length]=g(a)+'='+g(b)};if(isArray(a))for(d=0;a&&d<a.length;d++)h(a[d].name,a[d].value);else for(c in a)a.hasOwnProperty(c)&&buildParams(c,a[c],e,h);return f.join('&').replace(/%20/g,'+')},http.getcallbackPrefix=function(){return callbackPrefix},http.compat=function(a,b){return a&&(a.type&&(a.method=a.type)&&delete a.type,a.dataType&&(a.type=a.dataType),a.jsonpCallback&&(a.jsonpCallbackName=a.jsonpCallback)&&delete a.jsonpCallback,a.jsonp&&(a.jsonpCallback=a.jsonp)),new Reqwest(a,b)},http.ajaxSetup=function(a){a=a||{};for(var b in a)globalSetupOptions[b]=a[b]},http.internal={},http.internal.config=null,http.internal.request=function(a,b,c,d){var e=http.internal.config;if(!e)throw new Error('you should call http.config() before use it.');if(!e.domain||!e.project)throw new Error('no domain and project name found in your config.');a=e.domain+e.project+a,new Reqwest({url:a,method:b,data:c,cache:!1,async:!0,type:'text',crossOrigin:!0,timeout:e.timeout||3e4,contentType:'application/x-www-form-urlencoded; charset=UTF-8',error:function(a){'function'==typeof d&&d(-3,'网络异常，请检查您的网络('+a.status+':'+a.statusText+')')},success:function(a){var b,c,e,f,g,h=parseInt(a.getResponseHeader('error_code'));200===h?(b=a.response,b&&''!=b&&(b=JSON.parse(b)),c=0,b&&null!=b.errorCode&&void 0!=b.errorCode&&(c=b.errorCode),e='succeed',b&&null!=b.errorMsg&&void 0!=b.errorMsg&&(e=b.errorMsg),f=void 0,b&&'number'==typeof b.totalCount&&(f=b.totalCount),g=void 0,b&&'number'==typeof b.pageCount&&(g=b.pageCount),'function'==typeof d&&d(c,e,b.data,f,g)):100===h?'function'==typeof d&&d(-1,'您尚未登录或会话超时'):(console.error('error_code: '+h),'function'==typeof d&&d(-2,'服务器错误，请稍后重试'))},complete:function(){}})},http.config=function(a){http.internal.config=a},http.permission={},http.permission.logon=function(a,b,c){var d={userName:a,password:b},e='params='+encodeURIComponent(JSON.stringify(d));http.internal.request('/logon','POST',e,c)},http.permission.logout=function(a){http.internal.request('/logout','DELETE','',a)},http.permission.getPermissions=function(a,b){var c={type:a};http.internal.request('/user/profile','GET',c,b)},http.service={},http.service.request=function(a,b){var c,d,e,f,g,h,i=arguments.length;if(2>i)throw new error('call request with wrong params.');for(c=void 0,d='/service/'+a+'/'+b,e=new Array,f=2;i>f;f++)g=arguments[f],f==i-1&&'function'==typeof g?c=g:e.push(g);h='params='+encodeURIComponent(JSON.stringify(e)),http.internal.request(d,'POST',h,c)},http.service.request2=function(a,b,c,d){var e,f,g,h=arguments.length;if(2>h)throw new error('call request with wrong params.');if(e='/service/'+a+'/'+b,f='','object'==typeof c)for(g in c)''!=f&&(f+='&'),f+=g+'='+JSON.stringify(c[g]);http.internal.request(e,'POST',f,d)},http});
